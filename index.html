<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="ITOQ Space - –∫–∞—Ç–∞–ª–æ–≥ Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>ITOQ Space</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        background-color: var(--tg-theme-bg-color, #fff);
        color: var(--tg-theme-text-color, #000);
      }
      
      .header {
        background-color: var(--tg-theme-button-color, #008aee);
        color: var(--tg-theme-button-text-color, #fff);
        padding: 16px;
        text-align: center;
      }
      
      .categories {
        padding: 8px;
        display: flex;
        overflow-x: auto;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      
      .categories::-webkit-scrollbar {
        display: none;
      }
      
      .category {
        margin-right: 8px;
        padding: 8px 16px;
        background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
        color: var(--tg-theme-text-color, #000);
        border: none;
        border-radius: 20px;
        white-space: nowrap;
        font-size: 14px;
      }
      
      .category.active {
        background-color: var(--tg-theme-button-color, #008aee);
        color: var(--tg-theme-button-text-color, #fff);
      }
      
      .app-list {
        padding: 16px;
      }
      
      .app-card {
        display: flex;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
      }
      
      .app-icon {
        width: 48px;
        height: 48px;
        background-color: var(--tg-theme-button-color, #008aee);
        color: var(--tg-theme-button-text-color, #fff);
        border-radius: 8px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        margin-right: 16px;
        flex-shrink: 0;
      }
      
      .app-details {
        flex: 1;
      }
      
      .app-name {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 4px;
      }
      
      .app-description {
        font-size: 14px;
        color: var(--tg-theme-hint-color, #999);
        margin-bottom: 8px;
      }
      
      .tags {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 12px;
      }
      
      .tag {
        background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
        color: var(--tg-theme-text-color, #000);
        font-size: 12px;
        border-radius: 12px;
        padding: 2px 8px;
        margin-right: 4px;
        margin-bottom: 4px;
      }
      
      .open-button {
        background-color: var(--tg-theme-button-color, #008aee);
        color: var(--tg-theme-button-text-color, #fff);
        font-size: 14px;
        border: none;
        border-radius: 4px;
        padding: 4px 12px;
        cursor: pointer;
      }
      
      .spinner {
        width: 48px;
        height: 48px;
        border: 2px solid rgba(0, 0, 0, 0.1);
        border-top-color: var(--tg-theme-button-color, #008aee);
        border-radius: 50%;
        animation: spinner 1s ease-in-out infinite;
        margin: 48px auto;
      }
      
      @keyframes spinner {
        to {
          transform: rotate(360deg);
        }
      }
      
      .empty-state {
        text-align: center;
        padding: 30px 20px;
      }
      
      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
      }
      
      .empty-state-text {
        font-size: 16px;
        color: var(--tg-theme-hint-color, #999);
      }
      
      .error-state {
        text-align: center;
        padding: 30px 20px;
        color: #d73a49;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root">
      <header class="header">
        <h1>ITOQ Space</h1>
      </header>
      
      <div class="categories">
        <button class="category active" data-id="all">üì± –í—Å–µ</button>
        <button class="category" data-id="bots">ü§ñ –ë–æ—Ç—ã</button>
        <button class="category" data-id="channels">üì¢ –ö–∞–Ω–∞–ª—ã</button>
        <button class="category" data-id="apps">üì≤ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è</button>
      </div>
      
      <div class="app-list" id="app-list">
        <div class="spinner"></div>
      </div>
    </div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
    <!-- Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      
      // Initialize Telegram WebApp
      let tg;
      if (window.Telegram && window.Telegram.WebApp) {
        tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        tg.ready();
        tg.expand();
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ BackButton - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ > 1
        if (window.history.length > 1) {
          tg.BackButton.show();
          tg.BackButton.onClick(() => {
            // –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–Ω–∞–∑–∞–¥" - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            window.history.back();
          });
        }
        
        console.log('Telegram WebApp initialized');
        console.log('Platform:', tg.platform);
        console.log('Theme params:', tg.themeParams);
      }
      
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyAo9SiG37s11SV4NMtkgjrD9uJgVMU5TGM",
        authDomain: "itoqspace.firebaseapp.com",
        projectId: "itoqspace",
        storageBucket: "itoqspace.firebasestorage.app",
        messagingSenderId: "697002222083",
        appId: "1:697002222083:web:aa613fec438d630d0a2436",
        measurementId: "G-B72QN28VWV"
      };

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–æ –ª–∏ —Ä–∞–Ω–µ–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ Firebase
      let app;
      let db;
      
      try {
        // –ú–æ–¥—É–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ firebase.apps, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
        app = initializeApp(firebaseConfig);
        console.log("Firebase initialized (modular SDK)");
        db = getFirestore(app);
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
        // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        document.getElementById('app-list').innerHTML = `
          <div class="error-state">
            <p>–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
          </div>
        `;
      }
      
      // Sample fallback data in case Firebase isn't working
      const fallbackApps = [
        {
          id: "1",
          name: "TelegramBot Builder",
          description: "–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –±–æ—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è",
          icon: "ü§ñ",
          category: "bots",
          tags: ["–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä", "–ë–µ–∑ –∫–æ–¥–∞", "AI"],
          telegramLink: "https://t.me/BotFather"
        },
        {
          id: "2",
          name: "InfoChannel",
          description: "–ù–æ–≤–æ—Å—Ç–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ IT –∏–Ω–¥—É—Å—Ç—Ä–∏–∏",
          icon: "üì¢",
          category: "channels",
          tags: ["–ù–æ–≤–æ—Å—Ç–∏", "IT", "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"],
          telegramLink: "https://t.me/channel"
        },
        {
          id: "3",
          name: "MiniApp Creator",
          description: "–°–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –¥–ª—è Telegram",
          icon: "üì±",
          category: "apps",
          tags: ["–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞", "WebApps", "Telegram"],
          telegramLink: "https://t.me/miniappcreator"
        }
      ];
      
      // Apps data
      let apps = [];
      let selectedCategory = 'all';
      
      // Filter apps by category
      function filterApps(category) {
        return category === 'all' 
          ? apps 
          : apps.filter(app => app.category === category);
      }
      
      // Render app list
      function renderApps(category) {
        const appList = document.getElementById('app-list');
        const filteredApps = filterApps(category);
        
        appList.innerHTML = '';
        
        if (filteredApps.length === 0) {
          appList.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">üì≠</div>
              <p class="empty-state-text">–ù–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>
            </div>
          `;
          return;
        }
        
        filteredApps.forEach(app => {
          const appCard = document.createElement('div');
          appCard.className = 'app-card';
          appCard.setAttribute('data-id', app.id);
          
          appCard.innerHTML = `
            <div class="app-icon">${app.icon || 'üì±'}</div>
            <div class="app-details">
              <h3 class="app-name">${app.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h3>
              <p class="app-description">${app.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
              <div class="tags">
                ${(app.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
              </div>
              <button class="open-button" data-link="${app.telegramLink}">–û—Ç–∫—Ä—ã—Ç—å</button>
            </div>
          `;
          
          appList.appendChild(appCard);
        });
        
        // Add event listeners to open buttons
        document.querySelectorAll('.open-button').forEach(button => {
          button.addEventListener('click', (e) => {
            e.stopPropagation();
            e.preventDefault();
            
            const link = button.getAttribute('data-link');
            console.log("–ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É:", link);
            
            try {
              if (window.Telegram && window.Telegram.WebApp) {
                // –ï—Å–ª–∏ —ç—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ Telegram
                if (link.match(/^(https?:\/\/)?t\.me\//i)) {
                  // –£–¥–∞–ª—è–µ–º http/https –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
                  const tgPath = link.replace(/^(https?:\/\/)?t\.me\//i, '');
                  console.log("–û—Ç–∫—Ä—ã–≤–∞–µ–º Telegram —Å—Å—ã–ª–∫—É:", tgPath);
                  window.Telegram.WebApp.openTelegramLink(tgPath);
                } else {
                  // –û–±—ã—á–Ω–∞—è –≤–µ–±-—Å—Å—ã–ª–∫–∞
                  console.log("–û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–±—ã—á–Ω—É—é —Å—Å—ã–ª–∫—É:", link);
                  window.Telegram.WebApp.openLink(link);
                }
              } else {
                // Fallback –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
                window.open(link, '_blank');
              }
            } catch (error) {
              console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Å—ã–ª–∫–∏:", error);
              // Fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ
              alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é: " + link);
              window.open(link, '_blank');
            }
          });
        });
      }
      
      // Fetch apps from Firestore
      async function fetchApps() {
        const appList = document.getElementById('app-list');
        appList.innerHTML = '<div class="spinner"></div>';
        
        try {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
          if (!navigator.onLine) {
            throw new Error("–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É");
          }
          
          if (!db) {
            throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
          }
          
          // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–π–º–∞—É—Ç, —á—Ç–æ–±—ã –Ω–µ –∂–¥–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
          const timeout = new Promise((_, reject) => 
            setTimeout(() => reject(new Error("–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è")), 10000)
          );
          
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º Promise.race –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è
          const appsSnapshot = await Promise.race([
            getDocs(collection(db, 'apps')),
            timeout
          ]);
          
          if (appsSnapshot.empty) {
            console.log('No apps found in Firestore, using fallback data');
            apps = fallbackApps;
          } else {
            apps = appsSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            console.log('Apps loaded from Firestore:', apps.length);
          }
        } catch (error) {
          console.error('Error fetching apps from Firestore:', error);
          apps = fallbackApps;
          appList.innerHTML = `
            <div class="error-state">
              <p>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö: ${error.message}</p>
              <p>–ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ</p>
            </div>
          `;
        }
        
        // –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ —Ä–µ–Ω–¥–µ—Ä–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∏–∑ Firebase –∏–ª–∏ –∏–∑ fallback)
        renderApps(selectedCategory);
      }
      
      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
        // Fetch initial apps
        fetchApps();
        
        // Set up category buttons
        document.querySelectorAll('.category').forEach(button => {
          button.addEventListener('click', () => {
            // Update active button
            document.querySelector('.category.active').classList.remove('active');
            button.classList.add('active');
            
            // Update selected category and render
            selectedCategory = button.getAttribute('data-id');
            renderApps(selectedCategory);
          });
        });
      });
    </script>
  </body>
</html>