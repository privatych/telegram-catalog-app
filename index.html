<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ITOQ Space - –ö–∞—Ç–∞–ª–æ–≥ –±–æ—Ç–æ–≤, –∫–∞–Ω–∞–ª–æ–≤ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        background-color: var(--tg-theme-bg-color, #fff);
        color: var(--tg-theme-text-color, #000);
      }
      
      .header {
        background-color: var(--tg-theme-button-color, #008aee);
        color: var(--tg-theme-button-text-color, #fff);
        padding: 16px;
        text-align: center;
      }
      
      .categories {
        padding: 8px;
        display: flex;
        overflow-x: auto;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      
      .categories::-webkit-scrollbar {
        display: none;
      }
      
      .category {
        margin-right: 8px;
        padding: 8px 16px;
        background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
        color: var(--tg-theme-text-color, #000);
        border: none;
        border-radius: 20px;
        white-space: nowrap;
        font-size: 14px;
      }
      
      .category.active {
        background-color: var(--tg-theme-button-color, #008aee);
        color: var(--tg-theme-button-text-color, #fff);
      }
      
      .app-list {
        padding: 16px;
      }
      
      .app-card {
        display: flex;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
      }
      
      .app-icon {
        width: 48px;
        height: 48px;
        background-color: var(--tg-theme-button-color, #008aee);
        color: var(--tg-theme-button-text-color, #fff);
        border-radius: 8px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        margin-right: 16px;
        flex-shrink: 0;
      }
      
      .app-details {
        flex: 1;
      }
      
      .app-name {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 4px;
      }
      
      .app-description {
        font-size: 14px;
        color: var(--tg-theme-hint-color, #999);
        margin-bottom: 8px;
      }
      
      .tags {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 12px;
      }
      
      .tag {
        background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
        color: var(--tg-theme-text-color, #000);
        font-size: 12px;
        border-radius: 12px;
        padding: 2px 8px;
        margin-right: 4px;
        margin-bottom: 4px;
      }
      
      .open-button {
        background-color: var(--tg-theme-button-color, #008aee);
        color: var(--tg-theme-button-text-color, #fff);
        font-size: 14px;
        border: none;
        border-radius: 4px;
        padding: 4px 12px;
        cursor: pointer;
      }
      
      .spinner {
        width: 48px;
        height: 48px;
        border: 2px solid rgba(0, 0, 0, 0.1);
        border-top-color: var(--tg-theme-button-color, #008aee);
        border-radius: 50%;
        animation: spinner 1s ease-in-out infinite;
        margin: 48px auto;
      }
      
      @keyframes spinner {
        to {
          transform: rotate(360deg);
        }
      }
      
      .empty-state {
        text-align: center;
        padding: 30px 20px;
      }
      
      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
      }
      
      .empty-state-text {
        font-size: 16px;
        color: var(--tg-theme-hint-color, #999);
      }
      
      .error-state {
        text-align: center;
        padding: 30px 20px;
        color: #d73a49;
      }

      /* –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π UI –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –∞–¥–º–∏–Ω–∫–∏ */
      html.admin-page .header,
      html.admin-page .categories,
      html.admin-page .app-list {
        display: none;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    
    <!-- React App Container -->
    <div id="root"></div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –≤–∏–¥–∏–º–æ —Ç–æ–ª—å–∫–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ -->
    <div id="static-app">
      <header class="header">
        <h1>ITOQ Space</h1>
      </header>
      
      <div class="categories">
        <button class="category active" data-id="all">üì± –í—Å–µ</button>
        <button class="category" data-id="bots">ü§ñ –ë–æ—Ç—ã</button>
        <button class="category" data-id="channels">üì¢ –ö–∞–Ω–∞–ª—ã</button>
        <button class="category" data-id="apps">üì≤ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è</button>
      </div>
      
      <div class="app-list" id="app-list">
        <div class="spinner"></div>
      </div>
    </div>

    <!-- Firebase SDK –∏ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script type="module">
      document.addEventListener('DOMContentLoaded', function() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –Ω–∞ –∞–¥–º–∏–Ω—Å–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        const isAdminPage = window.location.hash.includes('/admin-login') || window.location.hash.includes('/admin');
        console.log("–¢–µ–∫—É—â–∏–π –ø—É—Ç—å:", window.location.hash);
        console.log("–ê–¥–º–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:", isAdminPage);
        
        if (isAdminPage) {
          // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ UI –Ω–∞ –∞–¥–º–∏–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
          document.documentElement.classList.add('admin-page');
          document.getElementById('static-app').style.display = 'none';
          
          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
          const firebaseConfig = {
            apiKey: "3vPjoDvsoNGQ6FXIbHTHBkF5r7JRci23",
            authDomain: "itoqspace.firebaseapp.com",
            projectId: "itoqspace",
            storageBucket: "itoqspace.appspot.com",
            messagingSenderId: "612345678901",
            appId: "1:612345678901:web:abc123def456ghi789jkl"
          };

          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
          firebase.initializeApp(firebaseConfig);
          console.log("Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞");
          
          // –ù–µ –≤—ã–ø–æ–ª–Ω—è–µ–º –¥–∞–ª—å–Ω–µ–π—à–∏–π –∫–æ–¥ –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞
          return;
        }

        // Initialize Telegram WebApp
        let tg;
        if (window.Telegram && window.Telegram.WebApp) {
          tg = window.Telegram.WebApp;
          
          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
          tg.ready();
          tg.expand();
          
          // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ BackButton - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ > 1
          if (window.history.length > 1) {
            tg.BackButton.show();
            tg.BackButton.onClick(() => {
              // –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–Ω–∞–∑–∞–¥" - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
              window.history.back();
            });
          }
          
          console.log('Telegram WebApp initialized');
          console.log('Platform:', tg.platform);
          console.log('Theme params:', tg.themeParams);
        }
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase –¢–û–õ–¨–ö–û –¥–ª—è Firestore, –±–µ–∑ apiKey
        const firebaseConfig = {
          apiKey: "3vPjoDvsoNGQ6FXIbHTHBkF5r7JRci23",
          authDomain: "itoqspace.firebaseapp.com",
          projectId: "itoqspace",
          storageBucket: "itoqspace.appspot.com",
          messagingSenderId: "612345678901",
          appId: "1:612345678901:web:abc123def456ghi789jkl"
        };

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–æ –ª–∏ —Ä–∞–Ω–µ–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ Firebase
        let app;
        try {
          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
          if (typeof firebase !== 'undefined') {
            app = firebase.initializeApp(firebaseConfig, "catalog-app");
            console.log("Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞");
          } else {
            console.error("Firebase –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω");
          }
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
        }
         
        // Sample fallback data in case Firebase isn't working
        const fallbackApps = [
          {
            id: "1",
            name: "TelegramBot Builder",
            description: "–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –±–æ—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è",
            icon: "ü§ñ",
            category: "bots",
            tags: ["–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä", "–ë–µ–∑ –∫–æ–¥–∞", "AI"],
            telegramLink: "https://t.me/BotFather"
          },
          {
            id: "2",
            name: "InfoChannel",
            description: "–ù–æ–≤–æ—Å—Ç–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ IT –∏–Ω–¥—É—Å—Ç—Ä–∏–∏",
            icon: "üì¢",
            category: "channels",
            tags: ["–ù–æ–≤–æ—Å—Ç–∏", "IT", "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"],
            telegramLink: "https://t.me/channel"
          },
          {
            id: "3",
            name: "MiniApp Creator",
            description: "–°–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –¥–ª—è Telegram",
            icon: "üì±",
            category: "apps",
            tags: ["–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞", "WebApps", "Telegram"],
            telegramLink: "https://t.me/miniappcreator"
          }
        ];
         
        // Apps data
        let apps = [];
        let selectedCategory = 'all';
         
        // Filter apps by category
        function filterApps(category) {
          return category === 'all' 
            ? apps 
            : apps.filter(app => app.category === category);
        }
         
        // Render app list
        function renderApps(category) {
          const appList = document.getElementById('app-list');
          const filteredApps = filterApps(category);
          
          appList.innerHTML = '';
          
          if (filteredApps.length === 0) {
            appList.innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <p class="empty-state-text">–ù–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>
              </div>
            `;
            return;
          }
          
          filteredApps.forEach(app => {
            const appCard = document.createElement('div');
            appCard.className = 'app-card';
            appCard.setAttribute('data-id', app.id);
            
            appCard.innerHTML = `
              <div class="app-icon">${app.icon || 'üì±'}</div>
              <div class="app-details">
                <h3 class="app-name">${app.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h3>
                <p class="app-description">${app.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                <div class="tags">
                  ${(app.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
                <button class="open-button" data-link="${app.telegramLink}">–û—Ç–∫—Ä—ã—Ç—å</button>
              </div>
            `;
            
            appList.appendChild(appCard);
          });
           
          // Add event listeners to open buttons
          document.querySelectorAll('.open-button').forEach(button => {
            button.addEventListener('click', (e) => {
              e.stopPropagation();
              e.preventDefault();
               
              const link = button.getAttribute('data-link');
              console.log("–ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É:", link);
               
              try {
                if (window.Telegram && window.Telegram.WebApp) {
                  // –ï—Å–ª–∏ —ç—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ Telegram
                  if (link.match(/^(https?:\/\/)?t\.me\//i)) {
                    console.log("–û—Ç–∫—Ä—ã–≤–∞–µ–º Telegram —Å—Å—ã–ª–∫—É:", link);
                     
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å WebApp –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º
                    if (tg.isExpanded) {
                      // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Ö–æ–¥, –Ω–∞–ø—Ä—è–º—É—é –ø–µ—Ä–µ–¥–∞–µ–º –ø–æ–ª–Ω—É—é —Å—Å—ã–ª–∫—É
                      window.open(link, '_blank');
                    } else {
                      // –ï—Å–ª–∏ WebApp –Ω–µ –≤ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ç–æ–¥
                      tg.openLink(link);
                    }
                  } else {
                    // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –≤–µ–±-—Å—Å—ã–ª–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º openLink
                    console.log("–û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–±—ã—á–Ω—É—é —Å—Å—ã–ª–∫—É:", link);
                    tg.openLink(link);
                  }
                } else {
                  // Fallback –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
                  window.open(link, '_blank');
                }
              } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Å—ã–ª–∫–∏:", error);
                 
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏, –ø—Ä–æ–±—É–µ–º –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞–ø—Ä—è–º—É—é
                try {
                  window.open(link, '_blank');
                  return; // –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫—Ä—ã–ª–∏, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                } catch (directError) {
                  console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞–ø—Ä—è–º—É—é:", directError);
                }
                 
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—å –≤—Ä—É—á–Ω—É—é
                const errorMessage = document.createElement('div');
                errorMessage.className = 'error-state';
                errorMessage.style.position = 'fixed';
                errorMessage.style.top = '50%';
                errorMessage.style.left = '50%';
                errorMessage.style.transform = 'translate(-50%, -50%)';
                errorMessage.style.backgroundColor = 'rgba(0,0,0,0.8)';
                errorMessage.style.padding = '20px';
                errorMessage.style.borderRadius = '10px';
                errorMessage.style.zIndex = '9999';
                errorMessage.style.color = '#fff';
                errorMessage.style.textAlign = 'center';
                errorMessage.style.maxWidth = '90%';
                
                errorMessage.innerHTML = `
                  <p>–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É.</p>
                  <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é: <a href="${link}" target="_blank" style="color: #fff; text-decoration: underline; word-break: break-all;">${link}</a></p>
                  <button id="closeError" style="padding: 8px 16px; background: #fff; color: #000; border: none; border-radius: 4px; margin-top: 10px; width: 100px; cursor: pointer; font-weight: bold;">OK</button>
                `;
                
                document.body.appendChild(errorMessage);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
                const closeButton = document.getElementById('closeError');
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                const removeErrorMessage = function() {
                  if (document.body.contains(errorMessage)) {
                    document.body.removeChild(errorMessage);
                  }
                };
                
                // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å —á–µ—Ç–∫–∏–º –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ–º –¥–µ–π—Å—Ç–≤–∏—è
                closeButton.addEventListener('click', removeErrorMessage);
                closeButton.addEventListener('touchstart', removeErrorMessage, {passive: true});
                closeButton.addEventListener('touchend', removeErrorMessage, {passive: true});
                
                // –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—Å–µ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –Ω–∞ —Å–ª—É—á–∞–π –∫–ª–∏–∫–∞ –≤–Ω–µ –∫–Ω–æ–ø–∫–∏
                errorMessage.addEventListener('click', function(e) {
                  if (e.target === errorMessage) {
                    removeErrorMessage();
                  }
                });
              }
            });
          });
        }
        
        // Fetch apps from Firestore
        async function fetchApps() {
          const appList = document.getElementById('app-list');
          appList.innerHTML = '<div class="spinner"></div>';
          
          try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            if (!navigator.onLine) {
              throw new Error("–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É");
            }
            
            if (!app) {
              throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ Firestore
            const db = app.firestore();
            const appsCollection = db.collection('apps');
            const appsSnapshot = await appsCollection.get();
            
            if (appsSnapshot.empty) {
              console.log('No apps found in Firestore, using fallback data');
              apps = fallbackApps;
            } else {
              // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã Firestore –≤ –æ–±—ä–µ–∫—Ç—ã JavaScript
              apps = [];
              appsSnapshot.forEach(doc => {
                const appData = doc.data();
                // –î–æ–±–∞–≤–ª—è–µ–º id –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –æ–±—ä–µ–∫—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                apps.push({
                  id: doc.id,
                  ...appData
                });
              });
              console.log('Apps loaded from Firestore:', apps.length);
              
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–ø–∏—é –≤ localStorage –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ
              localStorage.setItem('catalog_apps', JSON.stringify(apps));
            }
          } catch (error) {
            console.error('Error fetching apps from Firestore:', error);
            
            // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
            const cachedApps = localStorage.getItem('catalog_apps');
            if (cachedApps) {
              try {
                apps = JSON.parse(cachedApps);
                console.log('–ò—Å–ø–æ–ª—å–∑—É—é –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ localStorage:', apps.length);
              } catch (parseError) {
                // –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                apps = fallbackApps;
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', parseError);
              }
            } else {
              // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ localStorage, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ
              apps = fallbackApps;
            }
            
            appList.innerHTML = `
              <div class="error-state">
                <p>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã: ${error.message}</p>
                <p>–ò—Å–ø–æ–ª—å–∑—É–µ–º ${apps === fallbackApps ? '–¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ' : '–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'}</p>
              </div>
            `;
          }
          
          // –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ —Ä–µ–Ω–¥–µ—Ä–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
          renderApps(selectedCategory);
        }
         
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º—ã –Ω–µ –Ω–∞ –∞–¥–º–∏–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü–µ
        if (!isAdminPage) {
          // Fetch initial apps
          fetchApps();
           
          // Set up category buttons
          document.querySelectorAll('.category').forEach(button => {
            button.addEventListener('click', () => {
              // Update active button
              document.querySelector('.category.active').classList.remove('active');
              button.classList.add('active');
               
              // Update selected category and render
              selectedCategory = button.getAttribute('data-id');
              renderApps(selectedCategory);
            });
          });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π URL –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ (–∫–∞—Ç–∞–ª–æ–≥/–∞–¥–º–∏–Ω–∫–∞)
        window.addEventListener('hashchange', function() {
          const isAdmin = window.location.hash.includes('/admin-login') || window.location.hash.includes('/admin');
          document.documentElement.classList.toggle('admin-page', isAdmin);
          document.getElementById('static-app').style.display = isAdmin ? 'none' : 'block';
        });
      });
    </script>
  </body>
</html>